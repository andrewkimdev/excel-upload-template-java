<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Result</title>
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>
    <div class="container">
        <h1>Upload Result</h1>

        <div th:if="${result.success}" class="alert alert-success">
            <h2>Success</h2>
            <!--
            SECURITY: th:text automatically escapes HTML to prevent XSS attacks.
            Never use th:utext with user-controlled data.
            -->
            <p th:text="${result.message}"></p>
            <ul>
                <li>Rows Processed: <span th:text="${result.rowsProcessed}"></span></li>
                <li>Rows Created: <span th:text="${result.rowsCreated}"></span></li>
                <li>Rows Updated: <span th:text="${result.rowsUpdated}"></span></li>
            </ul>
        </div>

        <div th:if="${!result.success}" class="alert alert-error">
            <h2>Errors Found</h2>
            <p th:text="${result.message}"></p>
            <ul th:if="${result.rowsProcessed > 0}">
                <li>Total Rows: <span th:text="${result.rowsProcessed}"></span></li>
                <li>Error Rows: <span th:text="${result.errorRows}"></span></li>
                <li>Total Errors: <span th:text="${result.errorCount}"></span></li>
            </ul>
            <!--
            SECURITY NOTE: Download URL Handling
            =====================================
            The download URL is constructed using Thymeleaf's URL expression @{...}
            with a path variable bound to errorFileId (a UUID generated server-side).
            The controller validates the UUID format before file access.

            If you modify URL construction:
            1. Never include user-controlled data in URLs without validation
            2. Validate that URLs point only to allowed paths
            3. Always use th:href="@{...}" (Thymeleaf URL building) instead of
               raw th:href="${...}" to get proper context-path handling and encoding
            -->
            <p th:if="${result.errorFileId}">
                <a th:href="@{/api/excel/download/{id}(id=${result.errorFileId})}" class="download-link">Download Error Report</a>
            </p>
        </div>

        <a href="/upload/tariff-exemption" class="back-link">Back to Upload</a>
    </div>
</body>
</html>
